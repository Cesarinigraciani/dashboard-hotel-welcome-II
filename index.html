<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard PCI â€“ Inicio</title>
  <link rel="stylesheet" href="styles/style-v2.css" />
</head>

<body>

  <!-- ðŸ¢ Cabecera principal -->
<header class="header-principal">
  <img src="assets/img/logo-empresa.png" alt="Logo Aguero Instalaciones">

  <div class="titulo-principal">
    <h1>AVANCES PROYECTOS PCI</h1>
    <h2>Aguero Instalaciones</h2>
  <h3 class="subfirma">v3.0.0 â€” By: CÃ©sar Augusto</h3>
  </div>
</header>

  <!-- ðŸ”˜ Botones principales -->
  <div class="container">
    <button onclick="mostrarFormulario()"> Generar Proyecto Nuevo</button>
    <button onclick="mostrarLista()"> Abrir Proyecto Existente</button>
    <button onclick="modificarProyecto()"> Modificar Proyecto</button>
    <button onclick="borrarProyecto()"> Borrar Proyecto</button>
    <button onclick="modificarPlantas()"> Modificar Plantas</button>

    <!-- ðŸ“ Formulario nuevo proyecto -->
    <form id="formProyecto" class="form-proyecto" style="display: none;">
      <h3>Crear Nuevo Proyecto</h3>

      <div class="form-group">
        <label>Nombre del Proyecto</label>
        <input type="text" name="nombre" placeholder="Ej. Residencias Misterios">
      </div>

      <div class="form-group">
        <label>DirecciÃ³n</label>
        <input type="text" name="direccion" placeholder="Ej. Calle Fuego 123">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>CÃ³digo Postal</label>
          <input type="text" name="cp" placeholder="28053">
        </div>

        <div class="form-group">
          <label>Ciudad</label>
          <input type="text" name="ciudad" placeholder="Madrid">
        </div>
      </div>

      <div class="form-group">
        <label>Ingeniero TÃ©cnico Encargado</label>
        <input type="text" name="ingeniero" placeholder="Ej. Juan PÃ©rez">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Fecha Inicio de Obra</label>
          <input type="date" name="fecha">
        </div>

        <div class="form-group">
          <label>Tiempo estimado (horas)</label>
          <input type="number" name="tiempo" placeholder="120">
        </div>
      </div>

      <div class="form-group">
        <label>TÃ©cnico Encargado PCI</label>
        <input type="text" name="tecnico" placeholder="Ej. CÃ©sar Augusto">
      </div>

      <button type="button" class="btn-secundario" onclick="generarPlantas()"> Configurar Plantas</button>

      <div id="panelPlantas" style="display:none; margin-top:20px;">
        <label>NÃºmero de plantas:</label>
        <input type="number" id="numPlantas" min="1" max="20" value="1">

        <button type="button" class="btn-secundario" onclick="crearTarjetasPlantas()">Generar</button>

        <div id="contenedorPlantas" style="margin-top:20px;"></div>
      </div>

      <button type="button" class="btn-primario" onclick="guardarProyecto()">ðŸ’¾ Guardar Proyecto</button>
    </form>

   <!-- ðŸ“‚ Lista de proyectos existentes -->
<div id="listaProyectos" style="display: none;">
  <h3>Proyectos Existentes</h3>

  <!-- âœ… Selector de proyectos -->
  <select id="proyectosSelect" style="display: block; margin-bottom: 15px;">
    <option value="">Seleccione un proyecto...</option>
  </select>

  <!-- âœ… Botones de acciones -->
  <div class="acciones-proyecto">
    <button onclick="modificarProyecto()"> Modificar Proyecto</button>
    <button onclick="borrarProyecto()"> Borrar Proyecto</button>
    <button onclick="modificarPlantas()"> Modificar Plantas</button>
    <button onclick="abrirProyectoSeleccionado()"> Abrir Proyecto</button>

  </div>
 </div>   
</div>   
 <script>

  /* âœ… Detectar si venimos a editar un proyecto */
  window.addEventListener("load", () => {
  const modoEdicion = localStorage.getItem("modoEdicion");
  const proyecto = JSON.parse(localStorage.getItem("proyectoSeleccionado"));

  if (modoEdicion === "true" && proyecto && proyecto.id) {
    mostrarFormulario();
    cargarProyectoEnFormulario(proyecto);
    localStorage.removeItem("modoEdicion");
  }
});


  /* âœ… Mostrar formulario */
  function mostrarFormulario() {
    document.getElementById('formProyecto').style.display = 'block';
    document.getElementById('listaProyectos').style.display = 'none';
    document.getElementById('proyectosSelect').style.display = 'none';
  }

  /* âœ… Mostrar lista de proyectos */
  function mostrarLista() {
    document.getElementById('formProyecto').style.display = 'none';
    document.getElementById('listaProyectos').style.display = 'block';

    const select = document.getElementById('proyectosSelect');
    select.style.display = "block";
    select.innerHTML = `<option value="">Seleccione un proyecto...</option>`;

    const lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];

    lista.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.nombre;
      select.appendChild(opt);
    });

    // âœ… Proyectos fijos
    select.appendChild(new Option("Hotel Welcome II", "welcomeII"));
    select.appendChild(new Option("Residencias Misterios", "misterios"));
  }

  /* âœ… Abrir proyecto */
  function abrirProyecto(id) {
    if (!id) return;

    // âœ… Dashboards fijos
    if (id === "welcomeII") {
      window.location.href = "dashboard_welcome.html";
      return;
    }

    if (id === "misterios") {
      window.location.href = "dashboard_misterios.html";
      return;
    }

    // âœ… Proyectos dinÃ¡micos
    const lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
    const proyecto = lista.find(p => p.id == id);

    if (!proyecto) {
      alert("Proyecto no encontrado");
      return;
    }

    localStorage.setItem("proyectoSeleccionado", JSON.stringify(proyecto));
    window.location.href = "dashboard_dinamico.html";
  }

  /* âœ… BotÃ³n: Abrir proyecto seleccionado */
  function abrirProyectoSeleccionado() {
    const id = document.getElementById("proyectosSelect").value;

    if (!id) {
      alert("Seleccione un proyecto primero");
      return;
    }

    abrirProyecto(id);
  }

  /* âœ… Mostrar panel de plantas */
  function generarPlantas() {
    document.getElementById("panelPlantas").style.display = "block";
  }
/* âœ… Modificar proyecto */
function modificarProyecto() {
  const id = document.getElementById("proyectosSelect").value;

  if (!id) {
    alert("Seleccione un proyecto primero");
    return;
  }

  // âŒ Proyectos fijos NO se modifican
  if (id === "welcomeII" || id === "misterios") {
    alert("Este proyecto no permite modificaciÃ³n de datos");
    return;
  }

  const lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
  const proyecto = lista.find(p => p.id == id);

  if (!proyecto) {
    alert("Proyecto no encontrado");
    return;
  }

  localStorage.setItem("proyectoSeleccionado", JSON.stringify(proyecto));
  localStorage.setItem("modoEdicion", "true");

  mostrarFormulario();
  cargarProyectoEnFormulario(proyecto);
}
/* âœ… Borrar proyecto */
function borrarProyecto() {
  const id = document.getElementById("proyectosSelect").value;

  if (!id) {
    alert("Seleccione un proyecto primero");
    return;
  }

  // âŒ Proyectos fijos NO se borran
  if (id === "welcomeII" || id === "misterios") {
    alert("Este proyecto no se puede borrar");
    return;
  }

  let lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
  lista = lista.filter(p => p.id != id);

  localStorage.setItem("proyectosPCI", JSON.stringify(lista));

  alert("âœ… Proyecto borrado correctamente");
  window.location.reload();
}

  /* âœ… Crear tarjetas de plantas */
  function crearTarjetasPlantas() {
    const num = parseInt(document.getElementById("numPlantas").value);
    const contenedor = document.getElementById("contenedorPlantas");
    contenedor.innerHTML = "";

    for (let i = 1; i <= num; i++) {
      const tarjeta = document.createElement("div");
      tarjeta.className = "tarjeta-planta";
      tarjeta.innerHTML = `
        <h4>Planta ${i}</h4>

        <label>Nombre personalizado:
          <input type="text" class="nombre-planta" placeholder="Ej: Planta ${i}"
>
        </label>

        <label>Equipos a instalar:</label>
        <select class="select-equipos">
          <option value="Detectores">Detectores</option>
          <option value="Siray+Bscl">Siray+Bscl</option>
          <option value="Zocalos">ZÃ³calos</option>
          <option value="Central">Central Cofem</option>
          <option value="Baterias">BaterÃ­as</option>
          <option value="Pukay">Pukay</option>
          <option value="Mstay 8">Mstay 8</option>
          <option value="Mda2 Ylt">Mdy2 Ylt</option>
          <option value="Kamay">Kamay</option>
          <option value="Kit-Pmr">Kit-Pmr</option>
          <option value="Mda1y">Mda1y</option>
          <option value="Fuente Auxiliar">Fuente Auxiliar</option>
          <option value="Extintores">Extintores</option>
          <option value="Soportes">Soportes</option>
        </select>

        <button type="button" onclick="agregarEquipo(this)">AÃ±adir equipo</button>

        <ul class="lista-equipos"></ul>
      `;
      contenedor.appendChild(tarjeta);
    // âœ… Sincronizar nombre personalizado con el tÃ­tulo
const inputNombre = tarjeta.querySelector(".nombre-planta");
const titulo = tarjeta.querySelector("h4");

inputNombre.addEventListener("input", () => {
  const nuevoNombre = inputNombre.value.trim();
  titulo.textContent = nuevoNombre || `Planta ${i}`;
});

    }
  }

  /* âœ… Modificar plantas */
  function modificarPlantas() {
    const id = document.getElementById("proyectosSelect").value;

    if (!id) {
      alert("Seleccione un proyecto primero");
      return;
    }

    // âŒ Proyectos fijos NO se modifican
    if (id === "welcomeII" || id === "misterios") {
      alert("Este proyecto no permite modificar plantas");
      return;
    }

    const lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
    const proyecto = lista.find(p => p.id == id);

    if (!proyecto) {
      alert("Proyecto no encontrado");
      return;
    }

    localStorage.setItem("proyectoSeleccionado", JSON.stringify(proyecto));
    localStorage.setItem("modoEdicion", "true");

    window.location.href = "index.html#panelPlantas";
  }

  /* âœ… AÃ±adir equipo a una planta */
  function agregarEquipo(btn) {
    const tarjeta = btn.closest(".tarjeta-planta");
    const select = tarjeta.querySelector(".select-equipos");
    const lista = tarjeta.querySelector(".lista-equipos");

    const li = document.createElement("li");
    li.textContent = select.value;
    lista.appendChild(li);
  }

  /* âœ… Guardar proyecto nuevo */
  function guardarProyecto() {
    const plantas = [];
    document.querySelectorAll(".tarjeta-planta").forEach(t => {
      const nombre = t.querySelector(".nombre-planta").value || "Sin nombre";
      const equipos = Array.from(t.querySelectorAll(".lista-equipos li"))
                           .map(li => li.textContent);
      plantas.push({ nombre, equipos });
    });

    const proyecto = {
      id: Date.now(),
      nombre: document.querySelector("input[name='nombre']").value,
      direccion: document.querySelector("input[name='direccion']").value,
      cp: document.querySelector("input[name='cp']").value,
      ciudad: document.querySelector("input[name='ciudad']").value,
      ingeniero: document.querySelector("input[name='ingeniero']").value,
      fecha: document.querySelector("input[name='fecha']").value,
      tiempo: document.querySelector("input[name='tiempo']").value,
      tecnico: document.querySelector("input[name='tecnico']").value,
      plantas
    };

    let lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
    lista.push(proyecto);
    localStorage.setItem("proyectosPCI", JSON.stringify(lista));

    alert("âœ… Proyecto guardado correctamente");
    window.location.reload();
  }
/* âœ… Guardar cambios en un proyecto existente */
function guardarCambios() {
  const proyecto = JSON.parse(localStorage.getItem("proyectoSeleccionado"));
  if (!proyecto) {
    alert("Error: no hay proyecto cargado");
    return;
  }

  // âœ… Actualizar datos del formulario
  proyecto.nombre = document.querySelector("input[name='nombre']").value;
  proyecto.direccion = document.querySelector("input[name='direccion']").value;
  proyecto.cp = document.querySelector("input[name='cp']").value;
  proyecto.ciudad = document.querySelector("input[name='ciudad']").value;
  proyecto.ingeniero = document.querySelector("input[name='ingeniero']").value;
  proyecto.fecha = document.querySelector("input[name='fecha']").value;
  proyecto.tiempo = document.querySelector("input[name='tiempo']").value;
  proyecto.tecnico = document.querySelector("input[name='tecnico']").value;

  // âœ… Actualizar plantas
  proyecto.plantas = [];
  document.querySelectorAll(".tarjeta-planta").forEach(t => {
    const nombre = t.querySelector(".nombre-planta").value || "Sin nombre";
    const equipos = Array.from(t.querySelectorAll(".lista-equipos li"))
                         .map(li => li.textContent);

    proyecto.plantas.push({ nombre, equipos });
  });

  // âœ… Guardar en localStorage
  let lista = JSON.parse(localStorage.getItem("proyectosPCI")) || [];
  const index = lista.findIndex(p => p.id == proyecto.id);

  if (index !== -1) {
    lista[index] = proyecto;
  }

  localStorage.setItem("proyectosPCI", JSON.stringify(lista));

  alert("âœ… Cambios guardados correctamente");

  // âœ… Limpiar estado y volver al index
  localStorage.removeItem("modoEdicion");
  localStorage.removeItem("proyectoSeleccionado");
  window.location.href = "index.html";
}

  /* âœ… Cargar proyecto en modo ediciÃ³n */
  function cargarProyectoEnFormulario(proyecto) {
    document.querySelector("input[name='nombre']").value = proyecto.nombre || "";
    document.querySelector("input[name='direccion']").value = proyecto.direccion || "";
    document.querySelector("input[name='cp']").value = proyecto.cp || "";
    document.querySelector("input[name='ciudad']").value = proyecto.ciudad || "";
    document.querySelector("input[name='ingeniero']").value = proyecto.ingeniero || "";
    document.querySelector("input[name='fecha']").value = proyecto.fecha || "";
    document.querySelector("input[name='tiempo']").value = proyecto.tiempo || "";
    document.querySelector("input[name='tecnico']").value = proyecto.tecnico || "";

    const contenedor = document.getElementById("contenedorPlantas");
    contenedor.innerHTML = "";
    document.getElementById("panelPlantas").style.display = "block";

    proyecto.plantas.forEach((planta, index) => {
      const tarjeta = document.createElement("div");
      tarjeta.className = "tarjeta-planta";

      tarjeta.innerHTML = `
        <h4>Planta ${index + 1}</h4>

        <label>Nombre personalizado:
          <input type="text" class="nombre-planta" value="${planta.nombre}">
        </label>

        <label>Equipos a instalar:</label>
        <select class="select-equipos">
          <option value="Detectores">Detectores</option>
          <option value="Siray+Bscl">Siray+Bscl</option>
          <option value="Zocalos">ZÃ³calos</option>
          <option value="Central">Central Cofem</option>
          <option value="Baterias">BaterÃ­as</option>
          <option value="Pukay">Pukay</option>
          <option value="Mstay 8">Mstay 8</option>
          <option value="Mda2 Ylt">Mdy2 Ylt</option>
          <option value="Kamay">Kamay</option>
          <option value="Kit-Pmr">Kit-Pmr</option>
          <option value="Mda1y">Mda1y</option>
          <option value="Fuente Auxiliar">Fuente Auxiliar</option>
          <option value="Extintores">Extintores</option>
          <option value="Soportes">Soportes</option>
        </select>

        <button type="button" onclick="agregarEquipo(this)">AÃ±adir equipo</button>
        <button type="button" class="btn-eliminar-planta"> Eliminar planta</button>
       
        <ul class="lista-equipos">
          ${planta.equipos.map(eq => `<li>${eq}</li>`).join("")}
        </ul>
      `;
      contenedor.appendChild(tarjeta);
   // âœ… Sincronizar nombre personalizado con el tÃ­tulo
const inputNombre = tarjeta.querySelector(".nombre-planta");
const titulo = tarjeta.querySelector("h4");

inputNombre.addEventListener("input", () => {
  const nuevoNombre = inputNombre.value.trim();
  titulo.textContent = nuevoNombre || `Planta ${i}`;
});

// âœ… Eliminar tarjeta de planta
const btnEliminar = tarjeta.querySelector(".btn-eliminar-planta");
btnEliminar.addEventListener("click", () => {
  tarjeta.remove();
    });
 });

    const btnGuardar = document.querySelector(".btn-primario");
    btnGuardar.textContent = "ðŸ’¾ Guardar Cambios";
    btnGuardar.onclick = guardarCambios;
  }
</script>

</body>
</html>




